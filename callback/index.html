<html>
   <head>
      Hey you can toggle play and pause in this page.
   </head>
   <body>
      <button onclick="player.togglePlay().then(() => {
            console.log('Toggled playback!');
          });">Toggle</button>

      <button onclick="player.nextTrack().then(()=>{
         console.log('Skipped to next track');
         });">Next</button>

      <script src="https://sdk.scdn.co/spotify-player.js"></script>
      
      <script>

         let params = new URLSearchParams(window.location.hash.substring(1))
         let access_token = params.get("access_token")

         window.onSpotifyWebPlaybackSDKReady = () => {


            player = new Spotify.Player({
               name: 'Kris from web',
               getOAuthToken: getAuth => {
                  getAuth(access_token);
               },
               volume: 0.8
            })

            player.connect().then(success => {
               if (success) {
                  console.log('The Web Playback SDK successfully connected to Spotify!');
               }
            })



            function getUserData(accessToken) {
                  return $.ajax({
                        url: 'https://api.spotify.com/v1/me',
                        headers: {
                           'Authorization': 'Bearer ' + accessToken
                        }
                  });
               }            

            player.addListener('ready', ({ device_id }) => {
               console.log('Connected with Device ID', device_id);
               
               fetch(
                  `https://api.spotify.com/v1/search?q=sunflower&type=track`, {
                     headers: {
                        'Authorization': `Bearer ${access_token}`
                     }
                  }
               ).then(data => {
                  data.json().then(({tracks: { items }}) => {
                     console.log(items)
                     let uris = items.map(x=>x.uri)
                     console.log(uris)
                     fetch(`https://api.spotify.com/v1/me/player/play?device_id=${device_id}`, {
                        method: 'PUT',
                        body: JSON.stringify({ uris }),
                        headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${access_token}`
                        },
                     })
                  })
               })
            })
         }
      </script>
      <script id="result-template" type="text/x-handlebars-template">
         <dl>
           <img src="{{images.0.url}}">
           <dt>User Name</dt>
           <dd>{{id}}</dd>
           <dt>Display Name</dt>
           <dd>{{display_name}}</dd>
           <dt>Country</dt>
           <dd>{{country}}</dd>
           <dt>Followers</dt>
           <dd>{{followers.total}}</dd>
           <dt>Profile</dt>
           <dd><a href="{{external_urls.spotify}}" target="_blank">{{external_urls.spotify}}</a></dd>
           <dt>Email</dt>
           <dd>{{email}}</dd>
           <dt>Product</dt>
           <dd>{{product}}</dd>
         </dl>
     </script>
   </body>
</html>