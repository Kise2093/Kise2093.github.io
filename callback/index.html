<html>
   <head>
      Hey you can toggle play and pause in this page.
   </head>
   <body>
      <button onclick="player.togglePlay().then(() => {
            console.log('Toggled playback!');
          });">Toggle</button>

      <button onclick="player.nextTrack().then(()=>{
         console.log('Skipped to next track');
         });">Next</button>

      <button onclick="player.disconnect()">disconnect</button>
      <button onclick="player.getCurrentState().then(state => {
            if (!state) {
              console.error('User is not playing music through the Web Playback SDK');
              return;
            }
          
            let {
              current_track,
              next_tracks: [next_track]
            } = state.track_window;
          
            console.log('Currently Playing', current_track);
            console.log('Playing Next', next_track);
          });">Current</button>



      <script src="https://sdk.scdn.co/spotify-player.js"></script>
      
      <script>
        
         let params = new URLSearchParams(window.location.hash.substring(1));
         console.log(location.hash.substring(1));
         let access_token = params.get("access_token");
         console.log(access_token);

         window.onSpotifyWebPlaybackSDKReady = () => {

            player = new Spotify.Player({
               name: 'Kris from web',
               getOAuthToken: getAuth => {
                  getAuth(access_token);
               },
               volume: 0.5
            })

            player.connect().then(success => {
               console.log(success);
               if (success) {
                  console.log('The Web Playback SDK successfully connected to Spotify!');
               }
            })
            fetch(
                  `https://api.spotify.com/v1/search?q=afterdark&type=track`, {
                        headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${access_token}`
                     }
                  }
               ).then(data1 =>{
                  data1.json().then((track) =>{console.log(track)})
               })
            let userdata;
            fetch(`https://api.spotify.com/v1/me`,{
               headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${access_token}`
                     }
               }).then(data2 =>{
                  data2.json().then((user)=>
                  {
                     userdata = user;  
                     //console.log(user)
                     return userdata
                  })
               })
               console.log(userdata);
               url = `https://api.spotify.com/v1/me`;
              async function getData(url){
                  const response = await fetch(url, {
                     headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${access_token}`
                     }})
                  return "hey";
              }
              const data = getData(url);
              console.log(data);

              let getuserdata = fetch(`https://api.spotify.com/v1/me`,{
               headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${access_token}`
                     }
               }).then(data5 => data5.json())
               
               getuserdata.then(function(result){
                  console.log(result.display_name)
                  
               })
               var z;
               function getx(x){
                     x = 3;
                  return x
               }
               function gety(y){
                  y = 4;
                  z = y + getx();
                  z
                  return z;
               }
               console.log(getuserdata)

               function getusernames(result){
                  let getuserdata = fetch(`https://api.spotify.com/v1/me`,{
               headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${access_token}`
                     }
               }).then(data5 => data5.json())
               }



            player.addListener('ready', ({ device_id }) => {
               console.log('Web Playback is ready to be played!');
               console.log('Connected with Device ID', device_id);
               
               fetch(
                  `https://api.spotify.com/v1/search?q=sunflower&type=track`, {
                     headers: {
                        'Authorization': `Bearer ${access_token}`
                     }
                  }
               ).then(data => {
                  data.json().then(({tracks: { items }}) => {
                     console.log(items)
                     let uris = items.map(x=>x.uri)
                     console.log(uris)
                     fetch(`https://api.spotify.com/v1/me/player/play?device_id=${device_id}`, {
                        method: 'PUT',
                        body: JSON.stringify({ uris }),
                        headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${access_token}`
                        },
                     })
                  })
               })
            })
            console.log(player.addListener);
            var username;
            player.setName(username).then(() =>{

               let getuserdata = fetch(`https://api.spotify.com/v1/me`,{
               headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${access_token}`
                     }
               }).then(data5 => data5.json())
               
               getuserdata.then(function(result){
                  console.log(result.display_name)
                  username = result.display_name;
               })
               console.log(username);

               console.log('Player name updated!');
               fetch(`https://api.spotify.com/v1/me`,{
               headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${access_token}`
                     }
               }).then(data2 =>{
                  data2.json().then((user)=>{console.log(user)})
               })

             } );

            
            

         }
      </script>
      
      
   </body>
</html>